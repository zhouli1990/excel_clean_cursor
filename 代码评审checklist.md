## Python 后端代码评审 Checklist (Flask & Pandas)

**核心原则:**
- **可读性优先**: 代码首先是给人读的，其次才是给机器执行的。
- **简洁明了**: 避免过度设计和不必要的复杂性。
- **一致性**: 遵循项目既定的编码规范和风格。
- **健壮性**: 充分考虑异常处理和边界情况。
- **可维护性**: 代码易于理解、修改和扩展。
- **安全性**: 防范常见的安全漏洞。
- **性能意识**: 关注可能影响性能的关键代码路径。

---

### 一、编码规范与代码风格 (PEP 8 & 项目规范)

-   [ ] **命名规范**:
    -   [ ] 变量、函数、方法名使用 `snake_case` (小写字母和下划线)。
    -   [ ] 类名使用 `CapWords` (驼峰式，首字母大写)。
    -   [ ] 常量名使用 `ALL_CAPS` (全大写字母和下_线)。
    -   [ ] 模块名应简短、全小写。
    -   [ ] 命名清晰、表意明确，避免使用单字母变量名 (除非是循环计数器等约定俗成场景)。
-   [ ] **代码格式化**:
    -   [ ] 使用自动化工具 (如 Black, Yapf) 统一格式化代码。
    -   [ ] 每行代码长度不超过项目约定 (如 79 或 100 字符)。
    -   [ ] 合理使用空行分隔逻辑块。
    -   [ ] 运算符两侧留有空格，逗号后留有空格。
-   [ ] **导入规范**:
    -   [ ] `import` 语句分组：标准库、第三方库、本项目模块，组间空一行。
    -   [ ] 避免使用 `from module import *` (除非是 `__init__.py` 中为了导出)。
    -   [ ] 导入顺序按字母排序 (可选，但建议统一)。
-   [ ] **注释与文档**:
    -   [ ] 复杂的逻辑、算法或业务规则有清晰的注释。
    -   [ ] 公共函数、类、方法有标准的 Docstring (如 Google, reStructuredText, NumPy 风格)。
    -   [ ] Docstring 清晰描述功能、参数、返回值、可能抛出的异常。
    -   [ ] 及时更新或移除过时的注释。
-   [ ] **类型提示 (Type Hinting)**:
    -   [ ] 对函数参数和返回值使用类型提示，提高代码可读性和可维护性。
    -   [ ] 对复杂数据结构 (如 `Dict`, `List` 中的元素) 也添加类型提示。

---

### 二、业务逻辑与功能实现

-   [ ] **需求理解**:
    -   [ ] 代码是否准确实现了需求文档中的功能？
    -   [ ] 是否覆盖了所有业务场景和边界条件？
-   [ ] **逻辑清晰性**:
    -   [ ] 代码逻辑是否易于理解？能否通过重构简化？
    -   [ ] 是否有不必要的嵌套或复杂的条件判断？
    -   [ ] 函数/方法是否遵循单一职责原则 (SRP)？
-   [ ] **数据处理 (Pandas)**:
    -   [ ] DataFrame 操作是否高效？(避免不必要的循环，优先使用向量化操作)
    -   [ ] 是否正确处理了 `NaN` 值或空值？
    -   [ ] 数据类型转换是否正确？
    -   [ ] 是否有不必要的 DataFrame 副本创建 (`.copy()`)？
    -   [ ] 列名和索引使用是否一致和正确？
-   [ ] **API 交互 (Flask & 外部 API)**:
    -   [ ] Flask 路由定义是否清晰、RESTful？
    -   [ ] 请求参数校验是否完备 (类型、格式、范围)？
    -   [ ] 响应格式是否符合约定 (HTTP 状态码、JSON 结构)？
    -   [ ] 与外部 API (如阿里云百炼) 交互时，是否正确处理了认证、请求参数、响应解析？
    -   [ ] 是否有超时设置和重试机制 (针对外部 API 调用)？
-   [ ] **配置文件使用**:
    -   [ ] 配置项 (如 API Key, URL, 列名映射) 是否从配置文件 (`config.json`) 读取，避免硬编码？
    -   [ ] 配置加载是否健壮，能否处理配置缺失或格式错误的情况？

---

### 三、错误处理与健壮性

-   [ ] **异常处理**:
    -   [ ] 是否捕获了可能发生的特定异常，而不是宽泛的 `except Exception:`？
    -   [ ] 异常处理逻辑是否恰当 (记录日志、返回错误信息、重试、回滚等)？
    -   [ ] 是否避免了吞掉异常 (即 `except: pass`)？
    -   [ ] 自定义异常 (`AppError`) 是否在合适的场景使用？
    -   [ ] 装饰器 `@try_except_with_logging` 使用是否恰当？
-   [ ] **边界条件与输入校验**:
    -   [ ] 是否考虑了空输入、无效输入、极端值等边界情况？
    -   [ ] 对用户输入或外部传入的数据进行了严格校验？
-   [ ] **资源管理**:
    -   [ ] 文件操作后是否正确关闭文件句柄 (推荐使用 `with open(...) as ...:`)？
    -   [ ] 数据库连接等资源是否及时释放？

---

### 四、Pythonic 与代码质量

-   [ ] **代码简洁性**:
    -   [ ] 是否有重复代码？能否提取为函数或类？
    -   [ ] 是否使用了 Pythonic 的写法 (如列表推导式、生成器表达式、`enumerate`、`zip` 等)？
    -   [ ] 避免不必要的临时变量。
-   [ ] **模块化与包结构**:
    -   [ ] `utils/__init__.py` 导出是否与模块实际内容同步？
    -   [ ] 工具函数是否按功能合理组织到 `utils` 下的各个模块？
    -   [ ] 是否有循环导入问题？
-   [ ] **日志记录 (`logger`)**:
    -   [ ] 日志级别 (DEBUG, INFO, WARNING, ERROR, CRITICAL) 使用是否恰当？
    -   [ ] 日志信息是否包含足够的上下文，便于问题排查？
    -   [ ] 是否避免在循环中大量打印重复或无用日志？
    -   [ ] 敏感信息 (如 API Key) 是否已从日志中脱敏？

---

### 五、性能与资源利用

-   [ ] **算法效率**:
    -   [ ] 关键算法的时间复杂度和空间复杂度是否合理？
    -   [ ] 是否有明显的性能瓶颈？
-   [ ] **Pandas 性能**:
    -   [ ] 避免在 DataFrame 上使用 `iterrows()` 或 `apply(axis=1)` 进行行级操作，优先使用列级/向量化操作。
    -   [ ] 大型数据集合并、筛选操作是否高效？
-   [ ] **内存使用**:
    -   [ ] 是否加载了不必要的全量数据到内存？能否使用分块处理或流式处理？
    -   [ ] 是否有内存泄漏的风险？
-   [ ] **并发与异步 (如果适用)**:
    -   [ ] 任务队列 (`task_manager`) 的使用是否合理？
    -   [ ] 后台线程 (`threading`) 的管理是否安全，有无竞态条件风险？

---

### 六、安全性

-   [ ] **输入安全**:
    -   [ ] 是否对所有外部输入 (HTTP请求参数、上传文件内容等) 进行了严格的校验和清理，防止注入攻击 (如SQL注入、命令注入、XSS - 虽然XSS更偏前端，但后端API也需注意输出内容)？
-   [ ] **API 密钥与凭证管理**:
    -   [ ] API Key、密码等敏感信息是否安全存储 (如环境变量、配置文件且配置文件不提交到版本库)，严禁硬编码在代码中？
    -   [ ] 配置文件本身是否已加入 `.gitignore` (如果包含敏感信息)？
-   [ ] **文件上传安全**:
    -   [ ] 对上传文件的类型、大小、内容是否有限制和校验？
    -   [ ] 上传文件的存储路径是否安全，避免路径遍历？
-   [ ] **依赖库安全**:
    -   [ ] 项目依赖的第三方库是否存在已知的安全漏洞？(可使用工具如 `safety` 或 `pip-audit` 检查)

---

### 七、测试

-   [ ] **单元测试**:
    -   [ ] 核心业务逻辑、复杂函数、工具函数是否有对应的单元测试？
    -   [ ] 测试用例是否覆盖了正常场景、边界场景和异常场景？
    -   [ ] 测试是否独立、可重复执行？
-   [ ] **集成测试**:
    -   [ ] 模块间的交互、API接口是否进行了集成测试？

---

### 八、文档与可维护性

-   [ ] **README**: 项目 `README.md` 是否清晰描述了项目功能、如何安装、运行、配置？
-   [ ] **项目结构文档**: `项目结构.md` 是否与当前代码结构保持一致？
-   [ ] **设计方案文档**: `设计方案文档.md` 是否准确反映了当前的实现？
-   [ ] **代码可维护性**:
    -   [ ] 修改或扩展此代码是否容易？
    -   [ ] 是否有硬编码的魔法数字或字符串？能否用常量代替？

---

### Checklist 使用建议:
-   **PR (Pull Request) 流程中**: 要求提交者在提交PR前自行过一遍Checklist，评审者重点关注。
-   **逐步完善**: 根据项目实际情况和遇到的问题，不断迭代和完善此Checklist。
-   **工具辅助**: 结合静态分析工具 (如 Flake8, Pylint, Mypy) 和自动化测试，提高评审效率。
-   **团队共享**: 确保团队所有成员都理解并遵循此Checklist。

希望这份Checklist能帮助您的团队提升代码质量！